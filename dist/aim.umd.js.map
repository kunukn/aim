{"version":3,"file":"aim.umd.js","sources":["../src/aim.js"],"sourcesContent":["let qsa = expr => [].slice.call(document.querySelectorAll(expr), 0);\n\nlet uid = () => (Math.random() + \"\").substr(2);\n\nfunction aim(params) {\n  let { target } = params;\n  let options = { ...params };\n  delete options.target;\n\n  if (typeof target === \"string\") {\n    let elems = qsa(target);\n    if (elems && elems.length) {\n      let ids = [];\n      elems.forEach(el => {\n        let id = uid();\n        items.push({ id, target: el, data: getData(el), options });\n        ids.push(id);\n      });\n\n      if (elems.length === 1) return ids[0];\n\n      return ids;\n    }\n  }\n\n  let id = uid();\n  items.push({ id, target, data: getData(target), options });\n  return id;\n}\n\nlet items = [];\n/**\n * pointerVelocity Velocity of the pointer pointer\n * pointerMagnitude Magnitude of velocity\n * pointerPosition Position of the pointer pointer\n * avgDeltaTime Average delta time for a simple calculation of new position, x = x0 +  v * t\n * pointerX the last retrived x coordinate of pointer cursor\n * pointerY the last retrived y coordinate of pointer cursor\n * anticipator an object to debug where pointer is aiming\n * anticipator.size, anticipator.radius, anticipator.center, anticipator.rect anticipator related properties\n * anRad Radius (or size) of the anticipator, increases as pointer move faster\n */\n\nlet clamp = (value, min, max) => Math.min(Math.max(value, min), max);\n\nlet getMagnitude = ({ x, y }) => Math.sqrt(x * x + y * y);\n\nlet getAngle = ({ x, y }) => (Math.atan2(y, x) * 180) / Math.PI;\n\nlet createVector = () => ({ x: 0, y: 0 });\n\nlet pointerVelocity = createVector(),\n  pointerMagnitude = getMagnitude(pointerVelocity),\n  pointerPosition = createVector(),\n  avgDeltaTime = 12,\n  pointerX = 0,\n  pointerY = 0,\n  DEBUG = false,\n  anticipator = {\n    size: 50,\n    center: createVector(),\n    effectiveSize: 1\n  };\nanticipator.rect = {\n  x0: 0,\n  y0: 0,\n  x1: anticipator.size,\n  y1: anticipator.size\n};\n\n/*\n * Default anticipate function\n *\n * @function anticipateFunc\n *\n * @param {type} position: position of anticipator\n * @param {type} velocity: velocity of anticipator\n * @param {type} pointerX pointer X coordinate\n * @param {type} pointerY pointer Y coordinate\n * @param {type} anticipator anticipator object\n * @returns {undefined}\n */\n\nlet anticipateFunc = ({\n  position,\n  velocity,\n  pointerX,\n  pointerY,\n  anticipator\n}) => {\n  let a = anticipator;\n\n  // smoothen velocity values with ratio 0.7 / 0.3\n  if (position.x && position.y) {\n    velocity.x = velocity.x * 0.7 + (pointerX - position.x) * 0.3;\n    velocity.y = velocity.y * 0.7 + (pointerY - position.y) * 0.3;\n  }\n\n  position.x = pointerX;\n  position.y = pointerY;\n\n  pointerMagnitude = getMagnitude(velocity);\n  if (pointerMagnitude < 0.1) {\n    velocity.x = 0;\n    velocity.y = 0;\n  }\n\n  // change radius according to magnitude\n  a.effectiveSize = Math.sqrt(a.size * pointerMagnitude + 1);\n\n  /*\n      assign anticipator coordinates according to new velocity values\n      and smoothen it with ratio 0.7 / 0.3\n    */\n  a.center.x =\n    a.center.x * 0.7 + (position.x + velocity.x * avgDeltaTime) * 0.3;\n\n  let windowWidth = window.innerWidth;\n  let windowHeight = window.innerHeigh;\n\n  clamp(a.center.x, 0, windowWidth - a.effectiveSize);\n\n  a.rect.x0 = a.center.x - a.effectiveSize;\n  a.rect.x1 = a.center.x + a.effectiveSize;\n\n  a.center.y =\n    a.center.y * 0.7 + (position.y + velocity.y * avgDeltaTime) * 0.3;\n\n  clamp(a.center.y, 0, windowHeight - a.effectiveSize);\n\n  a.rect.y0 = a.center.y - a.effectiveSize;\n  a.rect.y1 = a.center.y + a.effectiveSize;\n};\n\naim.setDebug = isDebugEnabled => {\n  let debugElement = document.getElementById(\"#__aim-debug\");\n\n  if (isDebugEnabled) {\n    if (debugElement) return;\n\n    anticipator.element = createDebugObject();\n  } else {\n    anticipator.element = null;\n    debugElement && debugElement.remove();\n  }\n  DEBUG = isDebugEnabled;\n};\n\naim.setAnticipateFunction = func => {\n  anticipateFunc = func;\n};\n\nlet getData = target => {\n  let rect = null;\n  if (target instanceof HTMLElement) {\n    rect = target.getBoundingClientRect();\n  }\n\n  let { x, y, width, height } = rect || target;\n\n  if (width === \"100%\") {\n    x = 0;\n    width = window.innerWidth;\n  }\n  if (height === \"100%\") {\n    y = 0;\n    height = window.innerHeight;\n  }\n\n  return {\n    rect: {\n      x0: x,\n      y0: y,\n      x1: x + width,\n      y1: y + height\n    },\n    center: { x, y },\n    increment: 0\n  };\n};\n\n/*\n * Creates a circle object which is to be used to\n * show where the anticipator is at any time\n *\n * @returns {Object}\n */\nfunction createDebugObject() {\n  let size = anticipator.size;\n  let element = document.createElement(\"div\");\n  element.setAttribute(\"id\", \"__aim-debug\");\n  element.style.width = 2 * size + \"px\";\n  element.style.height = 2 * size + \"px\";\n  element.style[\"margin-left\"] = -size + \"px\";\n  element.style[\"margin-top\"] = -size + \"px\";\n\n  document.body.appendChild(element);\n\n  return element;\n}\n\n/*\n * Tests rectangle - rectangle intersection and gives the ratio of intersection. Max 1, min 0.\n *\n * @param {type} rect The first rectange\n * @param {type} rect2 The second rectange\n * @returns {Number} Ratio of intersection area to area of tailblazer\n */\n\nfunction intersectRatio(rect, rect2) {\n  let x_overlap = Math.max(\n    0,\n    Math.min(rect.x1, rect2.x1) - Math.max(rect.x0, rect2.x0)\n  );\n  let y_overlap = Math.max(\n    0,\n    Math.min(rect.y1, rect2.y1) - Math.max(rect.y0, rect2.y0)\n  );\n\n  return (\n    (x_overlap * y_overlap) /\n    (anticipator.effectiveSize * anticipator.effectiveSize)\n  );\n}\n\nlet getParamsForCallback = ({ item, intersectRatioValue }) => ({\n  id: item.id,\n  target: item.target,\n  rect: item.data.rect,\n  angle: getAngle(pointerVelocity),\n  intersectRatioValue: intersectRatioValue || 0,\n  pointerVelocity,\n  pointerMagnitude\n});\n\nlet tick = () => {\n  let a = anticipator;\n\n  if (!items.length) return;\n\n  anticipateFunc({\n    position: pointerPosition,\n    velocity: pointerVelocity,\n    pointerX,\n    pointerY,\n    anticipator\n  });\n\n  if (DEBUG) {\n    a.element.style.transform = `translate(${a.center.x}px, ${\n      a.center.y\n    }px) scale(${a.effectiveSize / a.size})`;\n  }\n\n  /*\n   * Iterate over each elements and calculate increment for all\n   * In each cycle, it increases by a value between 0 - 0.2 (reaches max if it fully intersects) and decreases by 0.05\n   * Increment can be between 0 and 2\n   * If it's greater than 1, aimEnter function will be called\n   * if it's less than or equal to 0, aimExit function will be called\n   */\n\n  items.forEach(item => {\n    let { target, data, options } = item;\n\n    let intersectRatioValue = intersectRatio(data.rect, a.rect);\n\n    // check if they intersects and pointer is not on the element\n    if (intersectRatioValue && pointerMagnitude !== 0) {\n      data.increment += intersectRatioValue * 0.2;\n      if (1 < data.increment && data.increment < 2) {\n        if (options.className && target instanceof HTMLElement)\n          target.classList.add(options.className);\n        if (typeof options.aimEnter === \"function\")\n          options.aimEnter.call(\n            target,\n            getParamsForCallback({\n              item,\n              intersectRatioValue\n            })\n          );\n\n        if (DEBUG) {\n          a.element.classList.add(\"__aim-debug--hit\");\n        }\n      } else if (data.increment > 2) {\n        data.increment = 2;\n        if (DEBUG) a.element.classList.add(\"__aim-debug--hit-2\");\n      } else {\n      }\n      return;\n    } else {\n      if (DEBUG) {\n        setTimeout(() => {\n          a.element.classList.remove(\"__aim-debug--hit\");\n          a.element.classList.remove(\"__aim-debug--hit-2\");\n        }, 0);\n      }\n    }\n\n    if (data.increment !== 0 && intersectRatioValue === 0) {\n      data.increment -= 0.05;\n      if (data.increment < 0) {\n        data.increment = 0;\n        if (options.className && target instanceof HTMLElement)\n          target.classList.remove(options.className);\n        if (typeof options.aimExit === \"function\") {\n          options.aimExit.call(target, getParamsForCallback({ item }));\n        }\n      }\n    }\n  });\n};\n\nlet isRunning = true;\nlet run = () => {\n  tick();\n  if (isRunning) requestAnimationFrame(run);\n};\n\nlet onMove = e => {\n  pointerX = e.clientX;\n  pointerY = e.clientY;\n};\n\nlet aimHasStarted = false;\n\naim.start = () => {\n  if (aimHasStarted) return;\n\n  aimHasStarted = true;\n  document.addEventListener(\"mousemove\", onMove);\n  isRunning = true;\n  run();\n};\naim.stop = () => {\n  if (!aimHasStarted) return;\n\n  aimHasStarted = false;\n\n  isRunning = false;\n  document.removeEventListener(\"mousemove\", onMove);\n};\n\naim.remove = target => {\n  let wasRemoved = false;\n  if (target instanceof HTMLElement) {\n    items.forEach(item => {\n      if (item.target === target) {\n        item = null;\n        wasRemoved = true;\n        return;\n      }\n    });\n  } else {\n    items.forEach(item => {\n      if (item.id === target.id) {\n        item = null;\n        wasRemoved = true;\n        return;\n      }\n    });\n  }\n  if (wasRemoved) items = items.filter(Boolean);\n\n  return wasRemoved;\n};\n\naim.updatePosition = target => {\n  let wasUpdated = false;\n  if (target instanceof HTMLElement) {\n    items.forEach(item => {\n      if (item.target === target) {\n        let data = getData(target);\n        item.data.rect = data.rect;\n        item.data.center = data.center;\n        item.data.increment = data.increment;\n        wasUpdated = true;\n        return;\n      }\n    });\n  } else {\n    items.forEach(item => {\n      if (item.id === target.id) {\n        let data = getData(target);\n        item.data.rect = data.rect;\n        item.data.center = data.center;\n        item.data.increment = data.increment;\n        wasUpdated = true;\n        return;\n      }\n    });\n  }\n  return wasUpdated;\n};\n\nexport default aim;\n"],"names":["qsa","expr","slice","call","document","querySelectorAll","uid","Math","random","substr","aim","params","target","options","elems","length","ids","forEach","el","id","items","push","data","getData","clamp","value","min","max","getMagnitude","x","y","sqrt","pointerVelocity","pointerMagnitude","pointerPosition","pointerX","pointerY","DEBUG","anticipator","size","center","effectiveSize","rect","x0","y0","x1","y1","anticipateFunc","position","velocity","a","windowWidth","window","innerWidth","windowHeight","innerHeigh","setDebug","isDebugEnabled","element","debugElement","getElementById","createElement","setAttribute","style","width","height","body","appendChild","remove","setAnticipateFunction","func","HTMLElement","getBoundingClientRect","innerHeight","increment","getParamsForCallback","item","intersectRatioValue","angle","atan2","PI","tick","transform","rect2","className","classList","add","aimEnter","setTimeout","aimExit","isRunning","onMove","e","clientX","clientY","aimHasStarted","start","addEventListener","run","requestAnimationFrame","stop","removeEventListener","wasRemoved","filter","Boolean","updatePosition","wasUpdated"],"mappings":"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"}