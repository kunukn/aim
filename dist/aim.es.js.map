{"version":3,"file":"aim.es.js","sources":["../src/aim.js"],"sourcesContent":["// https://stackoverflow.com/q/105034/815507\nlet uuidv4 = () =>\n  \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, c => {\n    let r = (Math.random() * 16) | 0;\n    return (c == \"x\" ? r : (r & 0x3) | 0x8).toString(16);\n  });\n\nfunction aim(options) {\n  return init(options);\n}\n\nlet items = [];\n/**\n * pointerVelocity Velocity of the pointer pointer\n * pointerMagnitude Magnitude of velocity\n * pointerPosition Position of the pointer pointer\n * avgDeltaTime Average delta time for a simple calculation of new position, x = x0 +  v * t\n * pointerX the last retrived x coordinate of pointer cursor\n * pointerY the last retrived y coordinate of pointer cursor\n * anticipator an object to debug where pointer is aiming\n * anticipator.size, anticipator.radius, anticipator.center, anticipator.rect anticipator related properties\n * anRad Radius (or size) of the anticipator, increases as pointer move faster\n */\n\nlet clamp = (value, min, max) => Math.min(Math.max(value, min), max);\n\nlet getMagnitude = v => Math.sqrt(v.x * v.x + v.y * v.y);\n\nlet createVector = () => ({ x: 0, y: 0 });\n\nlet pointerVelocity = createVector(),\n  pointerMagnitude = getMagnitude(pointerVelocity),\n  pointerPosition = createVector(),\n  avgDeltaTime = 12,\n  pointerX = 0,\n  pointerY = 0,\n  DEBUG = false,\n  anticipator = {\n    size: 50,\n    center: createVector(),\n    effectiveSize: 1\n  };\nanticipator.rect = {\n  x0: 0,\n  y0: 0,\n  x1: anticipator.size,\n  y1: anticipator.size\n};\n\n/*\n * Default anticipate function\n *\n * @function anticipateFunc\n *\n * @param {type} position: position of anticipator\n * @param {type} velocity: velocity of anticipator\n * @param {type} pointerX pointer X coordinate\n * @param {type} pointerY pointer Y coordinate\n * @param {type} anticipator anticipator object\n * @returns {undefined}\n */\n\nfunction anticipateFunc(position, velocity, pointerX, pointerY, anticipator) {\n  let a = anticipator;\n\n  // smoothen velocity values with ratio 0.7 / 0.3\n  if (position.x && position.y) {\n    velocity.x = velocity.x * 0.7 + (pointerX - position.x) * 0.3;\n    velocity.y = velocity.y * 0.7 + (pointerY - position.y) * 0.3;\n  }\n\n  position.x = pointerX;\n  position.y = pointerY;\n\n  pointerMagnitude = getMagnitude(velocity);\n  if (pointerMagnitude < 0.1) {\n    velocity.x = 0;\n    velocity.y = 0;\n  }\n\n  // change radius according to magnitude\n  a.effectiveSize = Math.sqrt(a.size * pointerMagnitude + 1);\n\n  /*\n      assign anticipator coordinates according to new velocity values\n      and smoothen it with ratio 0.7 / 0.3\n    */\n  a.center.x =\n    a.center.x * 0.7 + (position.x + velocity.x * avgDeltaTime) * 0.3;\n\n  let windowWidth = window.innerWidth;\n  let windowHeight = window.innerHeigh;\n\n  clamp(a.center.x, 0, windowWidth - a.effectiveSize);\n\n  a.rect.x0 = a.center.x - a.effectiveSize;\n  a.rect.x1 = a.center.x + a.effectiveSize;\n\n  a.center.y =\n    a.center.y * 0.7 + (position.y + velocity.y * avgDeltaTime) * 0.3;\n\n  clamp(a.center.y, 0, windowHeight - a.effectiveSize);\n\n  a.rect.y0 = a.center.y - a.effectiveSize;\n  a.rect.y1 = a.center.y + a.effectiveSize;\n}\n\nfunction setDebug(isDebugEnabled) {\n  let debugElement = document.querySelector(\"#aim-debug\");\n\n  if (isDebugEnabled) {\n    if (debugElement) return;\n\n    let debugObject = createDebugObject();\n    anticipator.element = debugObject;\n  } else {\n    debugElement && debugElement.remove();\n    anticipator.element = null;\n  }\n  DEBUG = isDebugEnabled;\n}\n\naim.setDebug = setDebug;\n\nfunction setAnticipateFunction(func) {\n  if (typeof func === \"function\") {\n    anticipateFunc = func;\n  }\n}\n\naim.setAnticipateFunction = setAnticipateFunction;\n\nlet getData = target => {\n  let rect = null;\n  if (target instanceof HTMLElement) {\n    rect = target.getBoundingClientRect();\n  }\n\n  let { x, y, width, height } = rect || target;\n\n  return {\n    rect: {\n      x0: x,\n      y0: y,\n      x1: x + width,\n      y1: y + height\n    },\n    center: { x, y },\n    increment: 0\n  };\n};\n\n/*\n * Creates a circle object which is to be used to\n * show where the anticipator is at any time\n *\n * @returns {Object}\n */\nfunction createDebugObject() {\n  let size = anticipator.size;\n  let element = document.createElement(\"div\");\n  element.setAttribute(\"id\", \"aim-debug\");\n  element.className = \"aim-debug\";\n  element.style.width = 2 * size + \"px\";\n  element.style.height = 2 * size + \"px\";\n  element.style[\"margin-left\"] = -size + \"px\";\n  element.style[\"margin-top\"] = -size + \"px\";\n\n  document.body.appendChild(element);\n\n  return element;\n}\n\n/*\n * Tests rectangle - rectangle intersection and gives the ratio of intersection. Max 1, min 0.\n *\n * @param {type} rect The first rectange\n * @param {type} rect2 The second rectange\n * @returns {Number} Ratio of intersection area to area of tailblazer\n */\n\nfunction intersectRatio(rect, rect2) {\n  let x_overlap = Math.max(\n    0,\n    Math.min(rect.x1, rect2.x1) - Math.max(rect.x0, rect2.x0)\n  );\n  let y_overlap = Math.max(\n    0,\n    Math.min(rect.y1, rect2.y1) - Math.max(rect.y0, rect2.y0)\n  );\n\n  return (\n    (x_overlap * y_overlap) /\n    (anticipator.effectiveSize * anticipator.effectiveSize)\n  );\n}\n\nfunction init(options) {\n  let { target } = options;\n  delete options.target;\n\n  let data = getData(target);\n  data.options = options;\n  let id = uuidv4();\n  items.push({ id, target, data });\n\n  return id;\n}\n\nlet tick = () => {\n  let a = anticipator;\n\n  if (!items.length) return;\n\n  anticipateFunc(pointerPosition, pointerVelocity, pointerX, pointerY, a);\n\n  if (DEBUG) {\n    a.element.style.transform = `translate(${a.center.x}px, ${\n      a.center.y\n    }px) scale(${a.effectiveSize / a.size})`;\n  }\n\n  /*\n   * Iterate over each elements and calculate increment for all\n   * In each cycle, it increases by a value between 0 - 0.2 (reaches max if it fully intersects) and decreases by 0.05\n   * Increment can be between 0 and 2\n   * If it's greater than 1, aimEnter function will be called\n   * if it's less than or equal to 0, aimExit function will be called\n   */\n\n  items.forEach(item => {\n    let target = item.target;\n    let data = item.data;\n\n    let intersectRatioValue = intersectRatio(data.rect, a.rect);\n\n    // check if they intersects and pointer is not on the element\n    if (intersectRatioValue && pointerMagnitude !== 0) {\n      data.increment = data.increment + intersectRatioValue * 0.2;\n      if (data.increment > 1 && data.increment < 2) {\n        if (data.options.className && target instanceof HTMLElement)\n          target.classList.add(data.options.className);\n        if (typeof data.options.aimEnter === \"function\")\n          data.options.aimEnter.call(target, item);\n\n        if (data.increment > 2) data.increment = 2;\n\n        if (DEBUG) a.element.style[\"background-color\"] = \"tomato\";\n      } else if (data.increment > 2) {\n        data.increment = 2;\n        if (DEBUG) a.element.style[\"background-color\"] = \"tomato\";\n      }\n      return;\n    } else {\n      if (DEBUG) a.element.style[\"background-color\"] = \"yellowgreen\";\n    }\n\n    if (data.increment !== 0) {\n      data.increment = data.increment - 0.05;\n      if (data.increment < 0) {\n        data.increment = 0;\n        if (data.options.className && target instanceof HTMLElement)\n          target.classList.remove(data.options.className);\n        if (typeof data.options.aimExit === \"function\")\n          data.options.aimExit.call(target, item);\n      }\n    }\n  });\n};\n\nlet isRunning = true;\nlet run = () => {\n  let token;\n  tick();\n  if (isRunning) {\n    token = requestAnimationFrame(run);\n  } else {\n    cancelAnimationFrame(token);\n  }\n};\n\nlet onPointerMove = e => {\n  pointerX = e.clientX;\n  pointerY = e.clientY;\n};\n\nlet aimHasStarted = false;\n\naim.start = () => {\n  if (aimHasStarted) return;\n\n  aimHasStarted = true;\n  document.addEventListener(\"pointermove\", onPointerMove);\n  isRunning = true;\n  run();\n};\naim.stop = () => {\n  if (!aimHasStarted) return;\n\n  aimHasStarted = false;\n\n  isRunning = false;\n  document.removeEventListener(\"pointermove\", onPointerMove);\n};\n\naim.remove = target => {\n  let wasRemoved = false;\n  if (target instanceof HTMLElement) {\n    items.forEach(item => {\n      if (item.target === target) {\n        item = null;\n        wasRemoved = true;\n        return;\n      }\n    });\n  } else {\n    items.forEach(item => {\n      if (item.id === target.id) {\n        item = null;\n        wasRemoved = true;\n        return;\n      }\n    });\n  }\n  if (wasRemoved) items = items.filter(Boolean);\n\n  return wasRemoved;\n};\n\naim.updatePosition = target => {\n  let wasUpdated = false;\n  if (target instanceof HTMLElement) {\n    items.forEach(item => {\n      if (item.target === target) {\n        let data = getData(target);\n        item.data.rect = data.rect;\n        item.data.center = data.center;\n        item.data.increment = data.increment;\n        wasUpdated = true;\n        return;\n      }\n    });\n  } else {\n    items.forEach(item => {\n      if (item.id === target.id) {\n        let data = getData(target);\n        item.data.rect = data.rect;\n        item.data.center = data.center;\n        item.data.increment = data.increment;\n        wasUpdated = true;\n        return;\n      }\n    });\n  }\n  return wasUpdated;\n};\n\nexport default aim;\n"],"names":["uuidv4","replace","c","r","Math","random","toString","aim","options","target","data","getData","id","items","push","init","clamp","value","min","max","getMagnitude","v","sqrt","x","y","pointerVelocity","pointerMagnitude","pointerPosition","avgDeltaTime","pointerX","pointerY","DEBUG","anticipator","size","center","effectiveSize","anticipateFunc","position","velocity","a","windowWidth","window","innerWidth","windowHeight","innerHeigh","rect","x0","x1","y0","y1","setDebug","isDebugEnabled","element","debugElement","document","querySelector","debugObject","createElement","setAttribute","className","style","width","height","body","appendChild","remove","setAnticipateFunction","func","HTMLElement","getBoundingClientRect","increment","tick","length","transform","forEach","item","rect2","intersectRatioValue","classList","add","aimEnter","call","aimExit","isRunning","onPointerMove","e","clientX","clientY","aimHasStarted","start","addEventListener","run","token","requestAnimationFrame","cancelAnimationFrame","stop","removeEventListener","wasRemoved","filter","Boolean","updatePosition","wasUpdated"],"mappings":"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"}